:root {
  --row-title: 52px;
  --row-flows: 44px;
  --row-toolbar: 40px;
  --left-col: 290px;
  --right-col: 320px;
  --bg-mid: #1f1f1f;
  --bg-light: #f5f7fa;
  --border: #2f2f2f;
  --accent: #ff7a00;
  --text: #e8e8e8;
  --pane-bg: #181818;
  --doc-font-family: Inter;
  --doc-font-size: 14px;
  --doc-text-color: #e8e8e8;
}
* { box-sizing: border-box; }
html, body { margin: 0; height: 100%; font-family: var(--doc-font-family), Segoe UI, Roboto, sans-serif; font-size: var(--doc-font-size); color: var(--doc-text-color); }
body { background: #0f0f0f; }
body{overflow:hidden}
body.theme-light{--bg-mid:#efefef;--border:#c8c8c8;--text:#1f1f1f;--pane-bg:#f5f5f5;--doc-text-color:#1e1e1e;background:#eaeaea}
body.theme-light .title-bar{background:#ffffff;color:#111}
body.theme-light .btn{background:#fff;color:#111;border-color:#b9b9b9}
body.theme-light .flows-bar,body.theme-light .category,body.theme-light .cat-title,body.theme-light .tab{background:#fff;color:#111}
body.theme-light .panel-header,body.theme-light .tabs{background:#f8f8f8}
body.theme-light textarea,body.theme-light input[type="text"],body.theme-light input[type="number"],body.theme-light select{background:#fff;color:#111;border-color:#b8b8b8}
.app-grid { display:grid; grid-template-columns: var(--left-col) 1fr var(--right-col); grid-template-rows: var(--row-title) var(--row-flows) 1fr var(--row-toolbar); height:100vh; transition:grid-template-columns .25s ease; }
.title-bar { grid-column:1/4; background:#000; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:0 16px; color:#fff; }
.actions{display:flex; gap:8px}
.btn{border:1px solid #444;background:#1d1d1d;color:#eee;padding:6px 10px;border-radius:6px;cursor:pointer;font-size:13px}
.btn:hover{border-color:var(--accent)}
.flows-bar { grid-column:1/4;background:var(--bg-mid);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;padding:6px 12px;overflow-x:auto; }
.flow-tab{border:1px solid #4b4b4b;border-radius:16px;padding:5px 12px;font-size:12px;cursor:pointer;background:#252525;white-space:nowrap}
.flow-tab.active{border-color:var(--accent);background:#332113}
.flow-name{pointer-events:none}
.flow-del{margin-left:8px;border:none;background:transparent;color:#bbb;cursor:pointer;font-size:14px}
.flow-del:hover{color:#fff}
.panel{border-right:1px solid var(--border);border-left:1px solid var(--border);min-width:0;min-height:0;display:flex;flex-direction:column}
.left-panel{grid-row:3;grid-column:1;border-left:none;background:var(--pane-bg);overflow-y:auto;overflow-x:hidden}
.left-panel{scrollbar-width:thin;scrollbar-color:#7a7a7a #1a1a1a}
.left-panel::-webkit-scrollbar{width:10px}
.left-panel::-webkit-scrollbar-track{background:#1a1a1a}
.left-panel::-webkit-scrollbar-thumb{background:#666;border-radius:8px}
.panel-header{display:flex;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px solid var(--border);gap:6px;flex-wrap:wrap}
.search{width:100%;padding:7px;background:#0f0f0f;border:1px solid #3b3b3b;color:#ddd;border-radius:6px}
.palette-controls{display:flex;gap:6px;width:100%}
.categories{overflow:visible;scrollbar-gutter:stable;-webkit-overflow-scrolling:touch;padding:10px;display:flex;flex-direction:column;gap:8px}
.categories{scrollbar-width:thin;scrollbar-color:#7a7a7a #1a1a1a}
.categories::-webkit-scrollbar{width:10px}
.categories::-webkit-scrollbar-track{background:#1a1a1a}
.categories::-webkit-scrollbar-thumb{background:#666;border-radius:8px}
.category{border:1px solid #343434;border-radius:8px;background:#202020;overflow:hidden}
.cat-title{margin:0;font-size:13px;padding:8px 10px;background:#272727;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.cat-items{display:grid;grid-template-columns:1fr;gap:6px;padding:8px}
.palette-item{border:1px solid #454545;border-radius:6px;padding:7px 8px;font-size:12px;cursor:grab;background:#111;display:flex;align-items:center;gap:7px}
.palette-swatch{width:12px;height:12px;border-radius:50%;border:1px solid #888;flex:none}
.palette-item-name{flex:1}
.palette-item-tools{display:flex;gap:4px;opacity:0;transition:opacity .15s}.palette-item:hover .palette-item-tools{opacity:1}
.inline-color{width:24px;height:18px;padding:0;border:none;background:transparent}
.collapsed .cat-items {display:none}
.center-panel{grid-row:3;grid-column:2;position:relative;overflow:hidden;background:linear-gradient(0deg, rgba(0,0,0,.12) 1px, transparent 1px),linear-gradient(90deg, rgba(0,0,0,.12) 1px, transparent 1px),var(--bg-light);background-size:24px 24px;border-left:none;border-right:none}
.canvas-overlay{position:absolute;inset:0;pointer-events:none;z-index:1}
.scene{position:absolute;inset:0;transform-origin:top left;z-index:2}
.selection-box{position:absolute;display:none;z-index:5;border:1px dashed #4c4c4c;background:rgba(120,120,120,.12);pointer-events:none}
.node-group{position:absolute;border:2px dashed #7f8c8d;border-radius:10px;z-index:0;pointer-events:auto}
.node-group.selected{outline:2px solid #111}
.group-title{padding:6px 8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.node{position:absolute;min-width:140px;max-width:340px;padding:10px 12px;border-radius:10px;color:#fff;border:2px solid rgba(255,255,255,.3);cursor:move;user-select:none;box-shadow:0 4px 12px rgba(0,0,0,.2);white-space:pre-wrap;word-break:break-word;line-height:1.3;z-index:4}
.node-label{white-space:pre-wrap;word-break:break-word;min-height:22px;user-select:text}
.node-label.editing{outline:1px dashed rgba(255,255,255,.8);padding:2px;cursor:text;background:rgba(0,0,0,.25);user-select:text}
.node.selected{outline:3px solid #111}
.node-toolbar{position:absolute;top:-24px;right:0;display:flex;gap:4px;opacity:0;transition:opacity .15s}
.node:hover .node-toolbar{opacity:1}
.mini-btn{border:1px solid rgba(255,255,255,.5);background:rgba(0,0,0,.4);color:#fff;border-radius:4px;font-size:10px;padding:1px 4px;cursor:pointer}
.port{position:absolute;width:14px;height:14px;border-radius:50%;background:#fff;border:2px solid #222;z-index:6}
.port.left{left:-10px;top:50%;transform:translateY(-50%)}
.port.right{right:-10px;top:50%;transform:translateY(-50%)}
.port.top{top:-10px;left:50%;transform:translateX(-50%)}
.port.bottom{bottom:-10px;left:50%;transform:translateX(-50%)}
.port-tag{position:absolute;font-size:10px;color:#111;background:rgba(255,255,255,.75);padding:1px 4px;border-radius:10px;pointer-events:none}
.port-tag.left{left:-48px;top:50%;transform:translateY(-50%)}
.port-tag.right{right:-44px;top:50%;transform:translateY(-50%)}
.node.type-code{min-width:280px;border-radius:8px}
.node.type-html{min-width:180px}
.node.type-activity{border-radius:0}
.node.type-inout{border-radius:0;transform:skewX(-12deg)}
.node.type-inout .node-label,.node.type-inout .node-toolbar,.node.type-inout .port,.node.type-inout .port-tag{transform:skewX(12deg)}
.node.type-connector{border-radius:50%;min-width:78px;width:78px !important;height:78px;padding:20px;display:flex;align-items:center;justify-content:center}
.node.type-if{border-radius:0;min-width:170px;width:170px !important;height:110px;padding:24px}
.diamond-text{transform:none}
.right-panel{grid-row:3;grid-column:3;background:#171717;border-right:none}
.tabs{display:flex;border-bottom:1px solid var(--border)}
.tab{flex:1;text-align:center;padding:8px;font-size:13px;cursor:pointer;border-right:1px solid var(--border);background:#202020}
.tab.active{background:#2b2b2b;border-bottom:2px solid var(--accent)}
.tab-content{display:none;height:100%;padding:10px;overflow:auto}.tab-content.active{display:block}
.lined{background:linear-gradient(to bottom, rgba(255,255,255,0.07) 1px, transparent 1px);background-size:100% 26px}
textarea,input[type="text"],input[type="color"],input[type="number"],select{width:100%;background:#101010;color:#ddd;border:1px solid #424242;border-radius:6px;padding:8px;font-size:12px;margin-bottom:8px;font-family:var(--doc-font-family)}
#notesArea,#taskArea,#mermaidCode{min-height:200px;resize:vertical}
.toolbar{grid-column:1/4;background:#111;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:6px 12px;font-size:12px}
.zoom-controls{display:flex;gap:6px;align-items:center}
#zoomValue{color:#ddd;min-width:48px;text-align:center;font-variant-numeric:tabular-nums}
.hidden-left{grid-template-columns:44px 1fr var(--right-col)}
.hidden-right{grid-template-columns:var(--left-col) 1fr 44px}
.hidden-left.hidden-right{grid-template-columns:44px 1fr 44px}
.collapsed-panel .categories,.collapsed-panel .tabs,.collapsed-panel .tab-content,.collapsed-panel .panel-header > :not(.collapse-btn){display:none !important}
.collapsed-panel .panel-header{justify-content:center}
.small-note{font-size:11px;color:#aaa}
.inline-props{margin-top:8px;display:grid;gap:6px}
.inline-props label{display:grid;gap:4px;font-size:12px;color:#bbb}
.inline-props textarea,.inline-props input,.inline-props select{width:100%}

.quickbar{position:fixed;left:300px;right:330px;top:98px;z-index:1100;background:#f2f2f2;color:#111;border:1px solid #bcbcbc;border-radius:8px;display:flex;gap:8px;align-items:center;padding:6px 8px;box-shadow:0 6px 18px rgba(0,0,0,.2)}
.quickbar.hidden{display:none}
.quick-group{display:flex;gap:6px;align-items:center;padding-right:8px;border-right:1px solid #d2d2d2}
.quick-group:last-child{border-right:none}
.quickbar select,.quickbar input[type="number"],.quickbar input[type="color"]{margin:0;background:#fff;color:#111;border:1px solid #bbb;padding:4px 6px;font-size:12px;width:auto}
.quickbar input[type="color"]{width:34px;height:28px;padding:2px}
.quick-lbl{display:flex;align-items:center;gap:4px;font-size:11px;color:#333}

.context-menu{position:fixed;z-index:1000;background:#191919;border:1px solid #555;border-radius:6px;padding:4px;display:none;min-width:190px}
.context-menu button{width:100%;text-align:left;background:transparent;border:none;color:#eee;padding:6px 8px;cursor:pointer}
.context-menu button:hover{background:#2c2c2c}
.link-path{fill:none;cursor:pointer;pointer-events:stroke}
.link-hit-path{fill:none;pointer-events:visibleStroke;cursor:pointer}
.link-path.selected{filter:drop-shadow(0 0 2px #000)}
.link-path.dragging{stroke-dasharray:6 4}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:1200;display:flex;align-items:center;justify-content:center}
.modal.hidden{display:none}
.modal-card{width:min(860px,92vw);max-height:88vh;overflow:auto;background:#1a1a1a;border:1px solid #555;border-radius:10px;padding:10px;box-shadow:0 14px 34px rgba(0,0,0,.45)}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;cursor:move}
.prop-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.prop-grid label{font-size:12px;color:#bbb;display:flex;flex-direction:column;gap:4px}
.prop-actions{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
